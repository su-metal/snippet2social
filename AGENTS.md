# 📱 Misepo (ミセポ) 要件定義書 Ver 1.1 (最終版)

## 1. プロジェクト概要
* **プロダクト名:** Misepo (ミセポ)
* **コンセプト:** 忙しい店舗オーナーのための、思考停止で使えるSNS投稿・口コミ返信作成ツール。
* **コアバリュー:** 「SNS運用（エンゲージメント向上）」よりも「今日の業務（投稿完了）」を最速で終わらせること。
* **ターゲット:** ITリテラシーが高くない個人店オーナー（飲食店、美容室、サロン等）。
* **プラットフォーム:** モバイル最適化 Webアプリ (PWA対応)。

---

## 2. ユーザーとプラン設計

### 2.1 ユーザーフロー
1.  **初回登録:** アカウント作成後、強制オンボーディングで「業種」「店名」を設定（AI精度の担保）。
2.  **日常利用:** トップ画面でネタを入力 → ボタン選択 → 生成 → 編集/コピー。
3.  **制限到達:** クレジット切れでProプラン誘導。

### 2.2 プラン構成 (フリーミアム)

| 項目 | 🆓 **Free プラン** | 💎 **Pro プラン** |
| :--- | :--- | :--- |
| **月額料金** | 0円 | 1,980円 (税込) |
| **クレジット制限** | **月3回** (+初回ボーナス3回) | **無制限** |
| **生成パターン** | 3案提示 (1つずつ選択) | 3案提示 (X/Insta一括生成可) |
| **Map返信言語** | 日本語のみ | 多言語 (英/中/韓 etc) |
| **カスタマイズ** | トーンスライダーのみ | トーン + **カスタム指示** + プリセット保存 |
| **編集機能** | 手動編集のみ | 手動 + **AI再編集** (Ver1.1以降) |

---

## 3. 機能要件 (Functional Requirements)

### 3.1 オンボーディング (必須)
* ユーザー登録直後、以下の情報を保存させる。
    * **業種 (Business Type):** プリセット選択（居酒屋、美容室、整体など）。
    * **店名 (Business Name):** 自由入力。

### 3.2 投稿生成機能 (SNS)
* **入力:**
    * テキストネタ (必須・プレースホルダーあり)
    * トーンスライダー (5段階: 厳格〜ギャル)
    * **投稿タイプ選択 (4択ボタン)**

#### 🔘 UIに表示する4つのボタン
| ボタン表示 | 英語ID | 役割・AIへの指示 | 想定シーン |
| :--- | :--- | :--- | :--- |
| **📣 宣伝・告知** | `Promotion` | 来店誘導、強いCTA（Call To Action）。 | 新メニュー、セール、イベント告知。 |
| **✨ 豆知識・コツ** | `Educational` | 専門性アピール、信頼獲得。 | 自宅ケア方法、美味しい食べ方解説。 |
| **☺️ 日常・裏側** | `Story` | 親近感、ブランディング。 | スタッフの様子、開店前の準備。 |
| **❓ 問いかけ** | `Engagement` | コメント誘発、顧客との交流。 | 「どっちが好き？」「クイズ」など。 |

#### 👻 隠し仕様 (Auto Detect)
* **🙏 お礼・報告モード:**
    * ユーザー入力に「休み」「完売」「ありがとう」「お詫び」等のキーワードが含まれていた場合、**どのボタンが選ばれていても、AIが自動的に「お礼・報告（誠実なトーン）」として処理する。**

### 3.3 口コミ返信機能 (Google Map)
* **入力:** 口コミ本文のコピペ。
* **挙動:**
    * **Free:** 丁寧な日本語の返信案を3つ生成。
    * **Pro:** 入力言語を自動判定し、相手の言語（英語等）に合わせて返信案を生成。

### 3.4 編集・保存機能
* **編集:** 生成結果は`<textarea>`で表示し、ユーザーがタップして直接修正可能（Free/Pro共通）。
* **コピー:** ワンタップでクリップボードにコピー。

---

## 4. ビジネスロジック・データベース要件

### 4.1 クレジット管理 (共通プール方式)
* SNS生成もMap返信も、全て**「1クレジット」**を消費する。
* **管理ロジック:**
    * `monthly_credits`: 毎月1日に **3** にリセット（Lazy Reset方式）。
    * `bonus_credits`: 初回登録時に **3** 付与。永久不滅。
    * **消費順序:** `monthly` → `bonus` の順に消費。
    * **Pro:** 無制限（消費ロジックをスキップ）。

### 4.2 データベース設計 (Supabase)

**Table: `profiles`**
```sql
create table profiles (
  id uuid references auth.users not null primary key,
  
  -- ユーザー属性 (AI生成の精度向上用)
  business_name text, 
  business_type text, 
  
  -- 課金・プラン
  is_pro boolean default false,
  stripe_customer_id text,
  
  -- クレジット (Start Dash & Monthly)
  monthly_credits integer default 3,
  bonus_credits integer default 3,
  last_reset_date timestamp with time zone,
  
  -- Pro用設定 (Ver1.1以降)
  custom_instruction text, 
  
  created_at timestamp with time zone default timezone('utc'::text, now())
);

## 5. UI/UX ガイドライン

### 5.1 失敗させないデザイン
* **プレースホルダー:** 「例：今日の日替わりはハンバーグです。デミグラスソースが自慢。」のように具体例を示す。
* **文字数アラート:** 入力が10文字以下の場合、「もう少し詳しく書くとAIが賢くなります」と警告。
* **確認ダイアログ:** 生成ボタン押下時、「残りクレジット: 〇回」を明示。

### 5.2 アプリらしさ (PWA)
* `manifest.json` 設定により、ホーム画面から起動時はアドレスバーを消す (`display: standalone`)。
* iOSのノッチ対応 (`viewport-fit=cover`)。
* 長押しによるメニュー表示や、不要なテキスト選択をCSSで無効化。

---

## 6. 技術スタック (Tech Stack)

* **Frontend:** Next.js 14+ (App Router), TypeScript
* **Styling:** Tailwind CSS, Shadcn/UI, Lucide React
* **Backend/DB:** Supabase (Auth, PostgreSQL, RLS)
* **AI:** OpenAI API (GPT-4o-mini)
* **Payment:** Stripe
* **Deployment:** Vercel

---

## 7. 開発ロードマップ (MVP Scope)

1.  **Phase 1: コア機能実装** (Supabase連携, API実装, UI構築)
2.  **Phase 2: 課金・制限実装** (クレジット消費ロジック, Stripe)
3.  **Phase 3: リリース準備** (PWA化, Vercelデプロイ)